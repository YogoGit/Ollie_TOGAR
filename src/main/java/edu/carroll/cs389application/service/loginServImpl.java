package edu.carroll.cs389application.service;

import edu.carroll.cs389application.jpa.model.login;
import edu.carroll.cs389application.jpa.repo.loginRepo;
import edu.carroll.cs389application.web.form.loginForm;
import org.springframework.stereotype.Service;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.util.List;

@Service
public class loginServImpl implements loginService {
    private static final Logger log = LoggerFactory.getLogger(loginServImpl.class);
    private final loginRepo loginR;

    /**
     *
     * @param loginRe
     */
    public loginServImpl(loginRepo loginRe) {
        this.loginR = loginRe;
    }

    /**
     *
     * @param LoginForm the data from our login page such as the username
     * @return true if the user exist, false elsewise
     */
    @Override
    public boolean validateUsername(loginForm LoginForm)    {
        log.info("Validating user: user '{} attempted login", LoginForm.getUsername());
        // grab our list
        List<login> users = loginR.findByUsernameIgnoreCase(LoginForm.getUsername());

        //No users were found as such new user must be created.
        if (users.size() == 0)  {
            login newuser = new login();
            newuser.setUsername(LoginForm.getUsername());
            loginR.save(newuser);
            log.debug("validateUser: no user found creating user {}", LoginForm.getUsername());
            return true;
        }
        //Multiple users found which shouldn't occur but must handle.
        if (users.size() > 1)   {
            log.debug("validateUser: found several {} users", users.size());
            return false;
        }

        //Found existing username, no password needed in my app
        log.debug("validateUser: successful login, single user found {}", LoginForm.getUsername());
        return true;

    }

}






























































































































































































































































































































































































































































































































































































































































































































































































































































































