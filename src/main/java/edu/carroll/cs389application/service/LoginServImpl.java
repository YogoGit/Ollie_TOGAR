package edu.carroll.cs389application.service;

import edu.carroll.cs389application.jpa.model.Login;
import edu.carroll.cs389application.jpa.repo.LoginRepo;
import edu.carroll.cs389application.web.form.LoginForm;
import org.springframework.stereotype.Service;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.util.List;

@Service
public class LoginServImpl implements LoginService {
    private static final Logger log = LoggerFactory.getLogger(LoginServImpl.class);
    private final LoginRepo loginR;

    /**
     *
     * @param loginRe
     */
    public LoginServImpl(LoginRepo loginRe) {
        this.loginR = loginRe;
    }

    /**
     *
     * @param LoginForm the data from our login page such as the username
     * @return true if the user exist, false elsewise
     */
    @Override
    public boolean validateUsername(LoginForm LoginForm)    {
        log.info("User '{} has attempted login", LoginForm.getUsername());
        // grab our list
        List<Login> users = loginR.findByUsernameIgnoreCase(LoginForm.getUsername());

        //No users were found as such new user must be created.
        if (users.size() == 0)  {
            Login newuser = new Login();
            newuser.setUsername(LoginForm.getUsername());
            loginR.save(newuser);
            log.debug("No user found: creating user {}", LoginForm.getUsername());
            return true;
        }
        //Multiple users found which shouldn't occur but must handle.
        if (users.size() > 1)   {
            log.error("Error: found several {} users", users.size());
            return false;
        }

        //Found existing username, no password needed in my app
        log.info("Success: successful login, single user found {}", LoginForm.getUsername());
        return true;

    }

}






























































































































































































































































































































































































































































































































































































































































































































































































































































































